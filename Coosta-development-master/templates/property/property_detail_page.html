{% extends "base.html" %}
{% block content %}
<style>
    .side_button {
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -pre-wrap;
        white-space: -o-pre-wrap;
        word-wrap: break-word;
        height: 100%;
        font-weight: bold;
        border-width: 2px;
        color: black;
        border-color: #70E0A3;
        background-color: white;
    }
    .social_share{
        padding-left: 1px;
        padding-right: 0px;
        padding-bottom: 5px;
    }
    .social_share-div{
        padding-right: 32px;
        padding-left: 9px;
    }
    #fb{
        width:100%;
        background-color:#3b5998;
        color:white;
    }
    #twitter{
        width:100%;
        background-color:#00b6f1;
        color:white;
    }
    #linkedin{
        width:100%;
        background-color:#007bb6;
        color:white;
    }
    #gplus{
        width:100%;
        background-color:#df4a32;
        color:white;
    }
</style>
<p></p>
<br/>
<br/>
<script src="/static/js/slider/jssor.slider-22.2.16.min.js" type="text/javascript"></script>
<script src="/static/js/slider/gallery_slider.js" type="text/javascript"></script>
<link rel="stylesheet" href="/static/css/slider/gallery_slider.css">
<div class="container-fluid">
    <div id="loaded_content" style="display:none;">
        <div id="jssor_1" style="position:relative;margin:0 auto;top:0px;left:0px;width:800px;height:456px;overflow:hidden;visibility:hidden;background-color:rgba(36,38,46,0);">
            <div data-u="slides" class="slider" style="cursor:default;position:relative;top:0px;left:0px;width:800px;height:456px;overflow:hidden;">
            </div>
            <!-- Thumbnail Navigator -->
            <div data-u="thumbnavigator" class="jssort01" style="position:absolute;left:700px;top:-22px;width:100px;height:500px;" data-autocenter="2">
                <!-- Thumbnail Item Skin Begin -->
                <div data-u="slides" style="cursor: default;">
                    <div data-u="prototype" class="p">
                        <div class="w">
                            <div data-u="thumbnailtemplate" class="t"></div>
                        </div>
                        <div class="c"></div>
                    </div>
                </div>
                <!-- Thumbnail Item Skin End -->
            </div>
            <!-- Arrow Navigator -->
            <span data-u="arrowleft" class="jssora05l" style="top:158px;left:8px;width:40px;height:40px;"></span>
            <span data-u="arrowright" class="jssora05r" style="top:158px;right:8px;width:40px;height:40px;"></span>
        </div>
        <!-- #endregion Jssor Slider End -->
        <br />
        <div class="property-detils-view row" style="padding:0 30px 0 30px;">
            <div class="col-md-8">
                <div class="content-pane">
                    <h5><span id="property_title"></span></h5>
                    <p class="address">#&nbsp;<span id="address"></span>,&nbsp;<span id="city"></span>,&nbsp;<span id="state"></span>&nbsp;&nbsp;
                        <span id="zip_code"></span>
                    </p>
                    <div class="price"><p class="price" id="property_value"></p>
                        <a href="#">See Estimates <i class="icon-down-arrow"></i></a>
                    </div>
                    <div class="property-features">
                        <table class="table" style="border-collapse:collapse;border-spacing:0;">
                            <tbody style="background-color:#eceeef;">
                            <tr>
                                <th style="border-right: solid 3px white;border-bottom: none;">HOME TYPE</th>
                                <th style="border-right: solid 3px white;border-bottom: none;">BEDS</th>
                                <th style="border-right: solid 3px white;border-bottom: none;">BATHS</th>
                                <th style="border-right: solid 3px white;border-bottom: none;">FLOOR SIZE (Sq Ft)</th>
                            </tr>
                            <tr>
                                <td style="border-right: solid 3px white;border-bottom: solid 3px white;border-top: none;"><span id="home_type"></span></td>
                                <td style="border-right: solid 3px white;border-bottom: solid 3px white;border-top: none;"><span id="beds"></span></td>
                                <td style="border-right: solid 3px white;border-bottom: solid 3px white;border-top: none;"><span id="baths"></span></td>
                                <td style="border-right: solid 3px white;border-bottom: solid 3px white;border-top: none;"><span id="property_size"></span></td>
                            </tr>
                            <tr>
                                <th style="border-right: solid 3px white;border-bottom: none;">FLOORS</th>
                                <th style="border-right: solid 3px white;border-bottom: none;">ROOF</th>
                                <th style="border-right: solid 3px white;border-bottom: none;">BASEMENT</th>
                                <th style="border-right: solid 3px white;border-bottom: none;">YEAR BUILT</th>
                            </tr>
                            <tr>
                                <td style="border-right: solid 3px white;border-bottom: none;border-top: none;"><span id="floors"></span></td>
                                <td style="border-right: solid 3px white;border-bottom: none;border-top: none;"><span id="roofs"></span></td>
                                <td style="border-right: solid 3px white;border-bottom: none;border-top: none;"><span id="basement"></span></td>
                                <td style="border-right: solid 3px white;border-bottom: none;border-top: none;"><span id="year_built"></span></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <h6>PROPERTY DESCRIPTION</h6>
                    <p><pre id="description"></pre></p>
                    <h6>AMENITIES</h6>
                    <p><span id="other_features"></span></p>
                </div>
            </div>
            {% if my_pro_flag == False %}
            <div class="col-md-4">
                <div class="shadow-box-01">
                    <div class="pad-3">
                        {% if user.is_authenticated %}
                        <div class="link-options">
                            <a href="#" id="toggle_shortlist_property"><i class="fa fa-heart-o" style="color:#70E0A3;"></i>
                                <span style="font-size:15px;font-family:sans-serif;margin-top:5px;">Favourite</span>
                            </a>
                            <a href="#" style="text-decoration:none;" data-toggle="modal" data-target="#shareModal">
                                <i class="fa fa-share-alt" style="color:#70E0A3;"></i>
                                <span style="font-size:15px;font-family:sans-serif;">Share</span>
                            </a>
                            <a href="#" data-toggle="modal" data-target="#ReportProperty" onclick="populate_property_report_drop_down()" style="text-decoration:none;"><i class="fa fa-fa" style="color:#70E0A3;"></i>
                                <span style="font-size:15px;font-family:sans-serif;">Report</span>
                            </a>
                        </div>

                        <!--Modal Pop up for Reporting a property-->
                        <div id="ReportProperty" class="modal fade" role="dialog">
                            <div class="modal-dialog modal-sm">

                                 <!-- Modal content-->
                                <div class="modal-content">
                                  <div class="modal-header" hidden="true"></div>
                                  <div class="modal-body">
                                      <div class="shadow-box-01" style="padding:20px;">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h3><p>REPORT</p></h3>
                                        <br>
                                        <form id="issue_reporter_form" name="issue_reporter_form">
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <select id="issuetypesdropdown" name="issuetypesdropdown" class="form-control" style="font-weight:bold;border-width:3px;color:black;border-color:#70E0A3;background-color:white;">SELECT ISSUE
                                                        </select>
                                                    </div>
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <p style="color:black">Enter Message</p>
                                                        <textarea id="reportmessage" name="reportmessage" class="form-control" rows="5"></textarea>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    <button type="submit" class="btn button-1 gradient-bg three-sharp-edge-l">
                                                        <b>Report</b>
                                                    </button>
                                                </div>
                                            </div>

                                        </form>

                                        <br>
                                        <br>
                                    </div>
                                  </div>
                                  <div class="modal-footer" hidden="true"></div>
                                </div>

                            </div>
                        </div>


                        {% endif %}
                        <div class="profile-section">
                            <figure class="clearfix">
                                <img id="owner_profile_image" src="/static/images/unisex_user_logo.png" />

                                <figcaption>
                                    <p class="name" id="owner_name"></p>
                                    <!--<span>Red Rocks</span>-->
                                </figcaption>
                            </figure>
                            <br />
                            <div class="row">
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <form action="/message/owner/" onsubmit="return send_message_arg()">
                                        <input type="hidden" id="owner_id">
                                        <input type="hidden" id="property_id">
                                        <button class="btn btn-success side_button">CONTACT OWNER</button>
                                    </form>
                                </div>
                                <div id="offer_btn" class="col-md-6 col-sm-6 col-xs-6">
                                    <form>
                                        <button type="button" onclick="checkPreApprovedorNonPreApprovedUser()"
                                                class="btn btn-success col-md-12 col-sm-12 col-xs-12 side_button">MAKE AN OFFER</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!--<div class="list-section">-->
                        <!--<h6>NEARBY</h6>-->
                        <!--<div class="list">BUS STOP - <strong>0.8 km</strong></div>-->
                        <!--<div class="list">SCHOOL- <strong>0.8 km</strong></div>-->
                        <!--<div class="list">HOSPITAL - <strong>0.8 km</strong></div>-->
                        <!--</div>-->
                        <div class="list-section">
                            <h6>DIRECTIONS</h6>
                        </div>
                    </div>
                    <div class="map-view">
                        <div id="map" style='height:180px; width:100%;'></div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        <div class="recommeded-properties" style="padding:0 30px 0 30px;">
            <h6>RECOMMENDED PROPERTIES</h6>
            <div class="property-list-view">
                <ul class="row" id="r_property">
                </ul>
            </div>
            <!--list-view-->
        </div>
        <!--recommeded-properties-->
    </div>
</div>
<!--content-wrapper-->
<!-- Modal Popup for Social Share-->
<div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-body">
              <div class="shadow-box-01">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
                  <br>
                  <div class="property-list-view property-list-search" style="padding-left:20px; height:auto;">
                      <h4>Share</h4>
                      <ul class="row properties_data" id="property_share"></ul>
                      <div class="col-md-12 col-sm-12 col-xs-12">
                          <div class="row">
                              <div class="col-md-12 col-sm-12 col-xs-12 social_share-div">
                                  <pre id="social_url"></pre>
                              </div>
                          </div>
                          <br>
                          <div class="row">
                              <div class="col-md-12 col-sm-12 col-xs-12 social_share-div">
                                  <div class="col-md-3 col-sm-6 col-xs-12 social_share">
                                      <a id="fb" class="btn btn-default" href="#"
                                          onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
                                            <i class="fa fa-facebook-square fa-2x" aria-hidden="true"></i>&nbsp;&nbsp;Facebook
                                      </a>
                                  </div>
                                   <div class="col-md-3 col-sm-6 col-xs-12 social_share">
                                       <a id="twitter" class="btn btn-default" href="https://twitter.com/share"
                                          data-show-count="false"
                                          onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
                                            <i class="fa fa-twitter-square fa-2x" aria-hidden="true"></i>&nbsp;&nbsp;Twitter
                                       </a>
                                  </div>
                                   <div class="col-md-3 col-sm-6 col-xs-12 social_share">
                                       <a id="gplus" class="btn btn-default" href="#"
                                          onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
                                           <i class="fa fa-google-plus-square fa-2x" aria-hidden="true"></i>&nbsp;&nbsp;Google +
                                       </a>
                                  </div>
                                   <div class="col-md-3 col-sm-6 col-xs-12 social_share">
                                      <a id="linkedin" class="btn btn-default" href="#"
                                         onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
                                          <i class="fa fa-linkedin-square fa-2x" aria-hidden="true"></i>&nbsp;&nbsp;LinkedIn
                                      </a>
                                  </div>
                              </div>
                          </div>
                          <br>
                          <p></p>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!--End Modal Popup Share -->

<!--Pre-Approved Popup Modal-->
<div class="modal fade" id="checkApprovalModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                <span class="span-close" aria-hidden="true">&times;</span>
                </button><br>
                <h4 class="text-center text-uppercase"> Are you Pre-Approved?</h4>
                <div class="text-center">
                    <form>
                        <button type="button" style="color:#FFFFFF;width:40%;" data-dismiss="modal" onclick="preApprovedUser({{user.id}})"
                                class="btn button-1 gradient-bg three-sharp-edge-l text-uppercase">Yes
                        </button>

                        <button type="button" class="btn button-1 gradient-bg three-sharp-edge-l text-uppercase"
                                style="color:#FFFFFF;width:40%;margin-left:5px;"
                                data-dismiss="modal"
                                onclick="nonPreApprovedUser({{user.id}})">No
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!--End of Pre-Approved Popup Modal-->

<!--Upload Approved Document Modal-->
<div class="modal fade" id="uploadDocumrntModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                <span class="span-close" aria-hidden="true">&times;</span>
                </button><br>

                <div class="row">
                    <div class="col-md-6">
                        <h5 style="color:#3AD4A7;"><b>Upload Documents</b></h5>
                    </div>
                </div>
                <div class="row" style="display:none;">
                    <table  width="100%" id="dataTables-example"
                            class="table table-striped table-bordered table-hover table-responsive css-serial">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>File</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody id="user_approved_docs">
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <div action="/api/documents/" class="dropzone decoration" id="my-awesome-dropzone" method="POST" enctype="multipart/form-data" style="padding: 15px;min-height: 100%;max-height: 100%;border: none;">
                        <div class="dz-message" data-dz-message style="margin: 0;top: 0px;height: 100%;">
                            <div class="col-md-12" style="background-color: #ccc;padding: 0px;height: 100%;">
                                <p class="text-center text-uppercase" style="color: #333;padding-top: 16px;"><b>Drag & drop or</b>
                                    <span style="color:red"><b style="color:#3AD4A7;">upload</b></span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <p></p>
                <div>
                    <div class="text-center">
                        <form>
                            <button type="button" style="color:#FFFFFF;width:40%;" data-dismiss="modal" onclick="document_next_button()"
                                    class="btn button-1 gradient-bg three-sharp-edge-l text-uppercase">Next
                            </button>
                        </form>
                    </div>
                </div>
                <br>
            </div>
        </div>
    </div>
</div>
<!--End of Upload Approved Document Modal-->

<!--make an Offer Popup Modal-->
<div class="modal fade" id="offerModal" role="dialog">
    <div class="modal-dialog" style="width:25%;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" hidden="true"></div>
            <div id="modal-body" class="modal-body" align="left">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <br>
                <h3><p>Make An Offer</p></h3>
                <br>
                Listing Price
                <h3 id="base_price"></h3>
                <p>Enter Offer Price</p>
                <form class="">
                    <input id="form-offer-amount-text" type="text" required>
                    <button type="button" class="btn button-1 gradient-bg three-sharp-edge-l"
                            onclick="offer_made({{ property_id }}, {{user.id}})">
                        Send Offer
                    </button>
                </form>
                <br>
                <br>
            </div>
            <div class="modal-footer" hidden="true"></div>
        </div>
    </div>
</div>
<!--end of make an Offer Popup Modal-->
    <!--footer-->
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <!--<script src="/static/js/apis/property_apis.js"></script>-->
    <!--<script src="/static/js/main.js"></script>-->
    <script src="/static/js/dropzone/dropzone.js"></script>
    <script src="/static/js/apis/flags_apis.js"></script>

    <link rel="stylesheet" href="/static/css/dropzone/dropzone.css">
    <link rel="stylesheet" href="/static/css/dropzone/basic.css">
	<script type="text/javascript">
        var property_data = "";
        $("document").ready(function(){
            $("#form-offer-amount-text").on("blur", function(){$("#form-offer-amount-text").val("$"+ parseInt($("#form-offer-amount-text").val().replace(/[$,]+/g,"")).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'))});
            set_ajax_token();
            var url = offers_base_url + '?property__id=' + "{{property_id}}&offered_by={{user.id}}";
            var offer_data = get_offers_on_properties(data, url).responseJSON;
            if(offer_data.count > 0){
                $("#offer_btn").html('<form style="margin-top: 10px;"><a href="/offers/" class="btn btn-success col-md-12 col-sm-12 col-xs-12 side_button">Check Your Offer</a></form>');
            }
            if(location.hostname != "coosta.com"){
                $('#twitter').addClass('disabled');
                $('#fb').addClass('disabled');
                $('#gplus').addClass('disabled');
                $('#linkedin').addClass('disabled');
            }
            render_property("{{ property_id }}");
            render_r_property("{{ property_id }}");
            var csrftoken = getCookie('csrftoken');
            var data = { "X-CSRFToken": csrftoken}
            var url = shortlisted_property_base_url + '?user={{user.id}}&property={{ property_id }}';
            //var url = shortlisted_property_base_url + '?' + filter;
            shortlisted_properties = get_shortlisted_properties_raw(data, url);
            if(shortlisted_properties.count == 0){
                $("#toggle_shortlist_property").html('<i onclick="add_shortlist_property({{ property_id }}, {{user.id}})" class="fa fa-heart-o" style="color:#70E0A3;"><span style="font-size:15px;font-family:sans-serif;margin-top:5px;">Favourite</span></i>');
            }
            else{
                $("#toggle_shortlist_property").html('<i onclick="remove_shortlist_property('+shortlisted_properties.results[0].id+')" class="fa fa-heart" style="color:#70E0A3;"><span style="font-size:15px;font-family:sans-serif;margin-top:5px;">Un Favourite</span></i>');
            }
            //Adding PageView for Property
            var page_view_data= {};
            page_view_data["property"] = "/api/property/{{property_id}}/";
            page_view_data["viewed_by"] ="/api/users/{{user.id}}/";
            add_page_view = post_page_view_for_property(page_view_data);
            $("#load_content").hide();
            $("#loaded_content").show();
            //setting the current url for sharing when click on share buttons
            var social_url = window.location.href;
            $("#fb").attr("href", "https://www.facebook.com/sharer/sharer.php?u="+social_url);
            $("#gplus").attr("href", "https://plus.google.com/share?url="+social_url);
            $("#linkedin").attr("href", "http://www.linkedin.com/shareArticle?url="+social_url);
            $("#social_url").html(social_url);
            var doc_count = 0;
            // Drop Zone functionality
            Dropzone.options.myAwesomeDropzone = {
            maxFilesize: 20, // Size in MB
            addRemoveLinks: true,
            removedfile: function(file) {
              var fileRef;
              return (fileRef = file.previewElement) != null ?
                      fileRef.parentNode.removeChild(file.previewElement) : void 0;
            },

            headers: {
                'X-CSRFToken': csrftoken
            },
            success: function(file, response) {
                $(".dz-preview").remove();
                var data = {};

                // Format of input data
                // {
                //     u'pre_approved_user': OrderedDict([(u'user', <User: coosta>)]),
                //     u'file': <User Document (UserDocuments/Virgin-Girls-Tops-Jeans-2014-Fashion-Fist-5_L6XlEBk.jpg)>
                // }
                data['pre_approved_user'] = {};
                data['pre_approved_user']['user'] = '/api/users/' + '{{ user.id }}' + '/';
                data['file'] = {};
                data['file'] = '/api/documents/' + response.id  + '/';

                var intermediate_table_post = post_pre_approved_document(data);

                doc_count++;
                //$("#image_stack").prepend('<div class="existingTag"><a href="#" onclick="delete_doc('+response['id']+')" class="closeButton">x</a><img id="'+response['id']+'" style="height: 106px;width: 100px;" src="'+response['file']+'" /></div>');
                $("#user_approved_docs").append('<tr><td>'+doc_count+'</td><td><a href="'+response['file']+'" target="_blank">'+response['file']+'</a></td><td><a href="#" onclick="delete_doc('+response['id']+')" class="closeButton">x</a></td></tr>');
                if(doc_count > 0){
                    $("#user_approved_docs").parent().parent().show();
                }
            }

            };
        });


        function delete_doc(id){
            var response = delete_document('/api/documents/'+id+'/');
            $("#"+id).parent().remove();
        };

        function render_property(filter){
            var url = property_base_url + filter;
            property_data = get_property(url).responseJSON;
            var csrftoken = getCookie('csrftoken');
            var token = { "X-CSRFToken": csrftoken}
            var owner_data = property_data.user;
            //render_images(property_data.images)
            var prop_image_list = [];
            if(property_data.images.length >= 1){
                var prop_image = '/static/images/no-image.png';
                for(var j=0; j<property_data.images.length; j++){
                    if(property_data.images[j].image.includes('virtual') === false){
                        prop_image_list.push(property_data.images[j].image);
                        prop_image = property_data.images[j].image;
                    }
                }
            }
            else{
                var prop_image = '/static/images/no-image.png'
            }
            if(property_data.property_title != null){
                $("#property_title").html(property_data.property_title.toString().toUpperCase());
            }
            if(owner_data.first_name){
                $("#owner_name").html(owner_data.first_name);
            }
            else{
                $("#owner_name").html(owner_data.username);
            }
            $("#owner_id").val(owner_data.id);
            $("#property_id").val(property_data.id);
            //if(owner_data.userprofile != null && owner_data.userprofile.profile_image != null){
                //$("#owner_profile_image").attr('src', owner_data.userprofile.profile_image);
            //}
            $("#property_base_image").attr('src', prop_image);
            for(var i=0; i<=prop_image_list.length-1; i++){
                if(i==0){
                    $(".slider").append('<div><img data-u="image" src="'+prop_image_list[i]+'"/><img data-u="thumb" src="'+prop_image_list[i]+'"/></div>');
                }
                else{
                    $(".slider").append('<div><img data-u="image" src="'+prop_image_list[i]+'"/><img data-u="thumb" src="'+prop_image_list[i]+'"/></div>');
                }
            }
            if(prop_image_list.length == 0){
                $(".slider").append('<div><img data-u="image" src="'+prop_image+'"/><img data-u="thumb" src="'+prop_image+'"/></div>');
            }
            jssor_1_slider_init();
            $("#home_type").html(property_data.home_type);
            $("#beds").html(property_data.beds);
            $("#baths").html(property_data.baths);
            $("#property_size").html(property_data.property_size);

            $("#address").html(property_data.address.toUpperCase());
            $("#city").html(property_data.city.toUpperCase());
            $("#state").html(property_data.state.toUpperCase());
            $("#zip_code").html(property_data.zip_code);

            $("#floors").html(property_data.floors);
            if(property_data.roof){
                $("#roofs").html("Yes");
            }
            else{
                $("#roofs").html("No");
            }
            $("#basement").html(property_data.basement);
            $("#year_built").html(property_data.year_built);

            $("#description").html(property_data.description);
            $("#other_features").html(property_data.other_features);

            $("#property_value").html("$"+ property_data.property_value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
            $("#base_price").html("$"+ property_data.property_value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
            $("#base_price").attr('price', property_data.property_value);
            $("#form-offer-amount-text").val("$"+ property_data.property_value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'));
            $("#load_spinner").hide();
            //code for populating property detail for share
            var template = '<li class="container-fluid page">';
            template += '<div style="width: 92%;margin-left: 2%;" class="shadow-box clearfix">';
            template += '<figure class="col-md-5" style="padding:1px;">';
            template += '<img src="'+prop_image+'" width="243px" height="158px">';
            template += '</figure>';
            template += '<div class="col-md-7" style="color:black;">';
            if(property_data.property_title){
                template += '<h5 style="margin-bottom:0px; margin-top:7px;">'+property_data.property_title+'</h5>';
            }
            else{
                template += '<h6 style="margin-bottom:0px; margin-top:7px;">&nbsp;</h6>';
            }
            template += '<p># '+property_data.address+'</p>';
            if(property_data.property_value != null){
                template += '<div class="price">$'+property_data.property_value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,')+'</div>';
            }
            else{
                template += '<div class="price">$0.00</div>';
            }
            template += '<div class="listed">Listed on '+property_data.listed_on+'</div>';
            template += '<table class="table" style="border-collapse:collapse;border-spacing:0;cellspacing:0;margin-bottom:10px;">';
            template += '<tbody style="background-color:#eceeef;">';
            template += '<tr>';
            template += '<th style="border-right: solid 3px white;">BEDS</th>';
            template += '<th style="border-right: solid 3px white;">BATHS</th>';
            template += '<th style="background-color:#eceeef;">SQFT</th>';
            template += '</tr>';
            template += '<tr>';
            template += '<td style="border-right: solid 3px white;border-top: none;">'+property_data.beds+'</td>';
            template += '<td style="border-right: solid 3px white;border-top: none;">'+property_data.baths+'</td>';
            template += '<td style="border:0px;">'+property_data.property_size+'</td>';
            template += '</tr>';
            template += '</tbody>';
            template += '</table>';
            template += '</div>';
            template += '</div>';
            template += '</li>';
            $("#property_share").append(template)
            // End of code for share
        }

        function render_images(image_array){
            var images = get_properties_images(image_array);
            for(var i=0; i<images.length; i++){
                var html1 = "<div><img src='"+images[i]+"'></div>";
                var html2 = "<div><img src='"+images[i]+"' width='200' height='200'></div>";
                $("#cycle-1").append(html1)
                $("#cycle-2").append(html2)
            }
        }

        function get_property_base_image(image_array){
            if(image_array.length >= 1){
                return get_properties_images_obj(image_array[0]).responseJSON.image;
            }
            else{
                return '/static/images/no-image.png'
            }
        }

        function render_r_property(filter){
            var url = "/api/recommended_properties/?id=" + filter;
            var property_data = get_recommended_properties(url).responseJSON;
            for(var i=0; i<property_data.count; i++){
                if(i < 2){
                    if(property_data.results[i].images.length >= 1){
                        var prop_image = '/static/images/no-image.png';
                        for(var j=0; j<property_data.results[i].images.length; j++){
                            if(property_data.results[i].images[j].image.includes('virtual') === false){
                                prop_image = property_data.results[i].images[j].image;
                            }
                        }
                    }
                    else{
                        var prop_image = '/static/images/no-image.png'
                    }
                    var template = '';
                    template += '<div class="col-sm-6">';
                    template += '<li class="page" style="list-style:none;">';
                    template += '<div class="shadow-box clearfix">';
                    template += '<a href="/property/preview/'+property_data.results[i].id+'/" style="text-decoration:none;">';
                    template += '<figure class="col-md-6 col-sm-6n nopadding">';
                    template += '<img src='+prop_image+' width="265px" height="210px">';
                    template += '</figure>';
                    template += '</a>';
                    template += '<div class="col-md-6 col-sm-6" style="color:black;">';
                    template += '<p></p>';
                    template += '<h5>'+property_data.results[i].property_title;
                    template += '<button onclick="add_shortlist_property('+property_data.results[i].id+', {{user.id}})" class="fa fa-heart-o pull-right" style="color:#70E0A3;cursor:pointer;background: none;border: none;"></button>';
                    template += '</h5>';
                    template += '<p># '+property_data.results[i].address+'</p>';
                    template += '<div class="price">$'+property_data.results[i].property_value.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    template += '<div class="listed pull-right" style="margin-top:11px; color:#ccc;">Listed on '+property_data.results[i].listed_on+'</div>';
                    template += '</div>';
                    template += '<table class="table table-bordered">';
                    template += '<tbody>';
                    template += '<tr>';
                    template += '<th>BEDS</th>';
                    template += '<th>BATHS</th>';
                    template += '<th>SQFT</th>';
                    template += '</tr>';
                    template += '<tr>';
                    template += '<td>'+property_data.results[i].beds+'</td>';
                    template += '<td>'+property_data.results[i].baths+'</td>';
                    template += '<td>'+property_data.results[i].property_size+'</td>';
                    template += '</tr>';
                    template += '</tbody>';
                    template += '</table>';
                    template += '</div>';
                    template += '</li>';
                    template += '</div>';
                    $("#r_property").append(template)
                }
            };
        }

        function offer_made(property_id, offered_by){
            var offer_val = parseInt($("#form-offer-amount-text").val().replace(/[$,]+/g,""));
            if(offer_val != "" && offer_val > 0 && offer_val <= parseInt($("#base_price").attr('price'))){
                var offer_data = {};
                offer_data["property"] = "/api/property/"+property_id+"/";
                offer_data["offered_by"] = "/api/users/"+offered_by+"/";
                offer_data["offer_amount"] = offer_val;
                post_offer_data = post_offer_on_property(offer_data);
            }
            else{
                $("#form-offer-amount-text").css('border', '2px solid red')
            }
        }

        // Function for checking PreApproved or NonPreApproved User
        function checkPreApprovedorNonPreApprovedUser(){
            var non_pre_approved_user_url = "/api/non_pre_approved_user/?user__id={{user.id}}";
            var pre_approved_user_url = "/api/pre_approved_user/?user__id={{user.id}}";

            var non_pre_approved_user = get_non_pre_approved_user(data='', non_pre_approved_user_url).responseJSON;
            var pre_approved_user = get_pre_approved_user(data='', pre_approved_user_url).responseJSON;
            if(non_pre_approved_user.count>0 || pre_approved_user.count>0){
                $('#offerModal').modal({
                    show: 'true'
                });
            }
            else{
                $('#checkApprovalModal').modal({
                    show: 'true'
                });
            }
        }

        //Function to post entry of non-pre-approved user
        function nonPreApprovedUser(user_id){
            var non_pre_approved_user_data = {};
            non_pre_approved_user_data["user"] = "/api/users/"+user_id+"/";
            var post_non_pre_approved_user_data = post_non_pre_approved_user(non_pre_approved_user_data)
            if(post_non_pre_approved_user_data.statusText == "Created"){
                $('#offerModal').modal({
                    show: 'true'
                });
            }
        }

        //Function to post entry of pre-approved user
        function preApprovedUser(user_id){
            var pre_approved_user_data = {};
            pre_approved_user_data["user"] = "/api/users/"+user_id+"/";
            var post_pre_approved_user_data = post_pre_approved_user(pre_approved_user_data)
            if(post_pre_approved_user_data.statusText == "Created"){
                $('#uploadDocumrntModal').modal({
                    show: 'true'
                });
            }
        }

        //Function to to just show the offer pop up
        function document_next_button(){
            $('#offerModal').modal({
                show: 'true'
            });
        }

        var flag_types = get_all_flag_types();

        // Loads Report property popup model's drop down menu with values from flagtype table
        function populate_property_report_drop_down(){
            $('#issuetypesdropdown').empty();
            $('#issuetypesdropdown').append('<option value="">SELECT ISSUE</option>')
            for(index in flag_types.responseJSON.results)
            {
                $('#issuetypesdropdown').append('<option value="' + flag_types.responseJSON.results[index].id + '">' + flag_types.responseJSON.results[index].flag_type_name + '</option>');
            }
        }

        // Report issue on property button click event
        $('#issue_reporter_form').submit(function () {
            if($('#issuetypesdropdown').val() != "" && $("#reportmessage").val() != "" ){
                report_the_property();
                return false;
            }
        });

        function report_the_property(){
            data = {};
            data['message'] =  $("#reportmessage").val();
            data['property'] = '/api/property/' + property_data.id + '/';
            data['type_of_flag'] = '/api/flagtype/' + $('#issuetypesdropdown').val() + '/';
            data['flag_raised_by'] = '/api/users/' + {{ user.id }} + '/';
            console.log(data);
            post_flagged_property(data);
            $('#ReportProperty').modal('hide');

        }





    </script>
    {% if my_pro_flag == False %}
        <script type="text/javascript">
            function initMap() {
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 16,
                    center: {lat: -34.397, lng: 150.644}
                });
                var geocoder = new google.maps.Geocoder();
                $("document").ready(function(){
                    geocodeAddress(geocoder, map, property_data.search_index);
                });
            }
            function geocodeAddress(geocoder, resultsMap, address) {
                geocoder.geocode({'address': address}, function(results, status) {
                    if (status === 'OK') {
                        resultsMap.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                        });
                    }
                    else{
                        console.log(address + ' Geocode was not successful for the following reason: ' + status);
                    }
                });
            }
        </script>
        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBlRSkdhAeYANHUa2eGtUJHv2gCQ1LHGU&callback=initMap">
        </script>
    {% endif %}
</div>
{% endblock content%}
